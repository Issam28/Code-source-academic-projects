<!DOCTYPE html>
<html>
<head>
    <title>Diap</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style.min.css" />
    <link rel="stylesheet" href=" css/font-awesome.min.css" />

    <script src='js/jquery.js'></script>
    <script src='js/jquery-ui.min.js'></script>
    <script src='js/bootstrap.min.js'></script>
    <script src='js/formValidation.js'></script>
    <script src='js/framework/bootstrap.js'></script>
</head>
<body class="eccp fr" >

<div id="wrapper">
    <!-- Sidebar -->

    <!-- /#sidebar-wrapper -->
    <!-- Page Content -->
    <div id="page-content-wrapper">
        <div class="container-fluid">
            <div class="row">
                <div class="heading">
                <h1 id ="step1">1- CHoisir le poids maximal</h1>
                    <h1 id="step2" style="display: none;">2- AJOUTER LES OBJETS</h1>
                    <h1 id ="step3" style="display: none;">3- JOUEZ ;)</h1>
                </div>

                <div class="col-md-8">

                    <div class="contact-form " id="display2">
                            <form method="post" class="defaultForm" >
                                <div class="form-group ">
                                    <label class="col-md-2  control-label" >LE POIDS MAX:</label>
                                    <div class="col-md-2">
                                        <input type="text"  name="Maximum1" class="form-control" >
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-2 ">
                                        <button type="submit"  onclick= "return SubmitMax()" id="subclick" class="btn btn-primary">Valider&nbsp;<i class="fa fa-check" ></i></button>
                                    </div>
                                </div>


                            </form>

                        </div>
                    <div class="contact-form  " id="displayGame" style="display: none;">


                            <div class="form-group">
                                <div class="col-md-3 col-md-offset-6">
                                    <button type="submit" onclick="return verifie_sol ()" class="btn btn-link">Verifier le résultat</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-3 ">
                                    <button type="submit" id="afficher_sol"  class="btn btn-link">Afficher le résultat</button>
                                </div>
                            </div>



                    </div>
                    <div class="contact-form"  id="display" style="display: none;" >
                        <form method="post" class="defaultForm"  >
                            <div class="form-group ">
                                <label class="col-md-1 control-label" >POIDS: </label>
                                <div class="col-md-2">
                                    <input type="text"  name="Poids" class="form-control">
                                </div>
                            </div>
                            <div class="form-group ">
                                <label class="col-md-1 control-label" >VALEUR: </label>
                                <div class="col-md-2">
                                    <input type="text"  name="Valeur" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-2 ">
                                    <button type="submit" onclick="return submit2()" class="btn btn-primary" id="AjouterId">Ajouter&nbsp;<i class="fa fa-plus" ></i></button>
                                </div>
                            </div>
                        </form>

                    </div>

                </div>

                <div class="col-md-4" >

                    <div class="contact-form">
                        <div class="form-group"  >
                            <div class="col-md-1 col-md-offset-11"  >
                                <img src="img/bin.png"  width="80"  id="drop-bin" style="float: right;" />
                            </div>

                        </div>
                    </div>
                </div>
                </div>

            <div style="margin: 25px 1px;"></div>
            <div class="row">
                <div class="col-md-7" id="well1" >

                <div class="well content row" id="issam" >

                    <h1>Ensembles des objets </h1>


                  </div>

                    </div>
                <div class="col-md-5"  id="well2" style="display: none;">
                    <div class="well content row" id="drop" style=" z-index: 1;" >
                        <h1>Sac à dos </h1>

                     </div>
                </div>

                 </div>
            <div class="row">
                <div  style="position: fixed; top: 0; right: 0" >
                <div class = "alert alert-success alert-dismissable fade in hide"  id="successAlert">
                    <button type = "button" class = "close"  aria-hidden = "true">
                        &times;
                    </button>
                    <h4 class="alert-heading">Congrats!</h4>

                    <p>tu as résolu le probléme :) </p>
                </div>
                </div>
                <div  style="position: fixed; top: 0; right: 0" >
                    <div class = "alert alert-danger alert-dismissable fade in hide  " id="errorAlert" >
                        <button type = "button" class = "close"  aria-hidden = "true">
                            &times;
                        </button>
                        <h4 class="alert-heading">oops!</h4>

                        <p>c'est pas la bonne solution,essayez encore... </p>
                    </div>
                </div>


                <div class="col-md-12" >
                    <div   id="Solution" style="display: none;">
                        <h1>La solution : </h1>
                    </div>
                </div>
                <div class="col-md-12">
                    <h1 id ="H1Matrice" style="display: none;">La matrice :</h1>
                <table id="Table" class="table table-striped table-bordered" style="display: none;">

                    <thead>
                    <tr id="Addth">
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
                </div>


                <div class="form-group" id="play" style="display: none;">
                    <div class="col-md-2 col-md-offset-6">
                        <button type="submit"  onclick="return begin()" class="btn btn-primary">Jouer&nbsp;<i class="fa fa-play" ></i></button>
                    </div>
                </div>
            </div>
            <div class="row" style="margin-top:15px">
            <div class="copywrite text-center">
                <div class="col-md-4 col-md-offset-4">
                    <p>TP N°1 de TPGO Réalisé par :BOUBECHTOULA Walid & MAHMOUDI Issam SIQG01 </p>
                    <p >Copyright © 2016 . Tous droits réservés</p>
                </div>
            </div>
            </div>
        </div>
        </div>
    </div>


<script>
    var Max=0;
    var Max_nb_objet=0;
    var var_poid_profit= [];
    var  var_poid_profit_user_sol= [];
    var VecteurSolution=[];
    var Var_Matrice;


    $('.alert .close').on('click', function(e) {
        $(this).parent().hide();
    });

    function verifie_sol ()
    {
        var matches = [];
        var perm = [];
        var searchEles = document.getElementById("drop").children;
        for(var i = 1; i <  searchEles.length; i++) {
                var str= parseInt(searchEles[i].children[0].innerText) ;
            perm[i-1]=str;
        }


        perm.sort(function(a, b){return a-b});
        var j=0;

        for( i = 0; i < Max_nb_objet ; i++) {
            var_poid_profit_user_sol[i]=0;

        }
        i=0;
        while (i<var_poid_profit_user_sol.length && j<perm.length) {
            if (perm[j]-1==i)   {var_poid_profit_user_sol[i]=1 ;j++;}
            i++;
        }

        var bool= verify_Sol(var_poid_profit_user_sol);
        if (bool==true)
        $('#successAlert').removeClass("hide").show();
        else $('#errorAlert').removeClass("hide").show();
        return false;
    }



    function verify_Sol (vector_input)
    {
        var i=0;
           while (i<VecteurSolution.length)
            {
                if (VecteurSolution[i]!=vector_input[i]) return false  ;
                i++;
            }

            return true;

    }



    function AfficheMatrice ()
    {
        $("#Addth").append('<th>Objet/Capacité</th>');

        for (var i=0;i<=Max;i++)
        {

            $("#Addth").append('<th>'+i+'</th>');
        }
        for ( i=0;i<Max_nb_objet;i++)
        {
            var j=i+1;
            $("#Table").append('<tr> <td>'+j+' Objets</td> </tr>');
            for (var j=0;j<=Max;j++)
            {
                $("tr:last").append('<td>'+Var_Matrice[i][j]+'<\/td>');
            }

        }
        }

    function begin()
    {
        $("#step2").hide();
        $("#step3").show();
        $("#display").hide();
        $("#play").hide();
        $("#drop-bin").hide();
        $("#displayGame").show();
        $("#well2").show();

        retreiveObjects();

        var sac = new Sac_A_Dos(Max_nb_objet,Max);
         VecteurSolution = sac.Programme_Dynamique_Sac_A_Dos(var_poid_profit);


        $("#Solution").append (' <h3>La valeur maximale de la solution optimale est :'+Var_Matrice[Max_nb_objet-1][Max]+'</h3>');

        for(var i=0; i<VecteurSolution.length;i++)
        {
           if  (VecteurSolution[i]==1)
           {
               $("#Solution").append('<div class="col-md-1">'+
                      '<p>Valeur: '+var_poid_profit[i][1]+'</p>'+
                       '<p>Poids: '+var_poid_profit[i][0]+' </p>'+
                      '</div>');

           }
        }

        AfficheMatrice ();


        return false ;
    }

    $("#afficher_sol").click(function(){
        $("#Solution").toggle();
        $("#H1Matrice").toggle();
        $("#Table").toggle();
    });


    function SubmitMax ( ) {


        var out = {};
        var s_data = $('form').serializeArray();

        for(var i = 0; i<s_data.length; i++){
            var record = s_data[i];
            out[record.name] = parseInt(record.value);

        }
        Max=out['Maximum1'];

        $("#step1").hide();
        $("#step2").show();

        $("#display").show();
        $("#play").show();

        $("#display2").hide();

        return false;
    }




    function submit2 ( ) {

        var out = {};
        var s_data = $('form').serializeArray();
        //transform into simple data/value object
        for(var i = 0; i<s_data.length; i++){
            var record = s_data[i];
            out[record.name] = parseInt(record.value);

        }

        var div = document.getElementById('issam');
        if (out['Poids']==="" || out['Valeur']==="" )
        {
            return true;
                 }
        else if ( out['Poids'] <= parseInt(Max)) {


        div.innerHTML = div.innerHTML + ' <div class="col-md-1 draggable" style=" z-index: 2;">'+
                    '<img src="img/object.png"  width="60"  />'+
                   ' <p>P='+out['Poids']+'</p>'+
                   '<p>V='+out['Valeur']+'</p>'+
                '</div></div>';
            $(".draggable").draggable({ cursor: "pointer",revert: "invalid",helper:"original",containment: ".container-fluid"});
        }else {

                alert ("le poids d'un objet doit étre inferieur ou egale au poids max !!");
        }

        return false;
    }



    function retreiveObjects (){
        var matches = [];
        var searchEles = document.getElementById("issam").children;
        Max_nb_objet=searchEles.length-1;

        for(var i = 1; i <  searchEles.length; i++) {
            var_poid_profit[i-1] = new Array(2);

            for(var j = 1; j < searchEles[i].children.length; j++)
            {
                var str= searchEles[i].children[j].innerText ;
                var_poid_profit[i-1][j-1]=parseInt(str.substring(2,str.length));
            }
            searchEles[i].innerHTML ='<span style="margin-left:25px">'+i+'</span>' + searchEles[i].innerHTML;
        }


        return false;
    }




    $(document).ready(function(){

    $("#drop").droppable({ accept: ".draggable",
        drop: function(event, ui) {

            $(this).removeClass("border").removeClass("over");
            var dropped = ui.draggable;
            var droppedOn = $(this);
            $(dropped).detach().css({top: 0,left: 0}).appendTo(droppedOn);
        },
        over: function(event, elem) {
            $(this).addClass("over");

        },
        out: function(event, elem) {
            $(this).removeClass("over");
        }
    });

        $("#issam").droppable({ accept: ".draggable",
            drop: function(event, ui) {

                $(this).removeClass("border").removeClass("over");
                var dropped = ui.draggable;
                var droppedOn = $(this);
                $(dropped).detach().css({top: 0,left: 0}).appendTo(droppedOn);
            },
            over: function(event, elem) {
                $(this).addClass("over");

            },
            out: function(event, elem) {
                $(this).removeClass("over");
            }
        });

        $("#drop-bin").droppable({ accept: ".draggable",
            drop: function(event, ui) {


                var dropped = ui.draggable;
                var droppedOn = $(this);
                $(dropped).remove();
            }});

        $('.defaultForm').formValidation({
            message: 'This value is not valid',
            icon: {
                valid: 'fa fa-check',
                invalid: 'fa fa-times',
                validating: 'fa fa-refresh'
            },

            fields: {
                Maximum1: {
                    validators: {
                        digits: {
                            message: 'cette valeur doit étre entier'
                        },
                        notEmpty: {
                            message: 'le champ ne doit pas être vide'
                        }
                    }
                },
               Valeur : {
                    validators: {
                        digits: {
                            message: 'cette valeur doit étre entier'
                        },
                        notEmpty: {
                            message: 'le champ ne doit pas être vide'
                        }
                    }
                },
                Poids : {
                    validators: {
                        digits: {
                            message: 'cette valeur doit étre entier'
                        },

                        notEmpty: {

                            message: 'ce champ ne doit pas être vide'
                        }
                    }
                },

            }
        });
    });


    //*******************************************************************************************************//
    function Sac_A_Dos(  var_nb_max_object,   var_poid_max_sac ){
        var var_nb_max_object;
        var var_poid_max_sac;
     
        var Var_Liste_Objets_Selectionnees;

        /**initialisation*/
        this.var_poid_max_sac=var_poid_max_sac;
        this.var_nb_max_object=var_nb_max_object;

        /**allocation dynamique de la matrice*/
        Var_Matrice = new Array(this.var_nb_max_object);
        for( var var_i =0 ; var_i<this.var_nb_max_object; var_i++) Var_Matrice[var_i]= new Array(this.var_poid_max_sac+1);

        /**allocation dynamique du vecteur qui contient la solution */
        this.Var_Liste_Objets_Selectionnee= new Array(this.var_nb_max_object);

        /** intialisation du vecteur qui contient la solution ***/
        for(var_i= 0; var_i<this.var_nb_max_object;var_i++) this.Var_Liste_Objets_Selectionnee[var_i]=0;


        /**
         * la fonction Programme_Dynamique_Sac_A_Dos a en entrée la liste des poid-protil des objets
         * et elle retourne un vecteurSolution (objet admet 1 objet refus 0)
         **/

        this.Programme_Dynamique_Sac_A_Dos= function( var_poid_profil  ){

            /**
             *on rempli la première ligne de la matrice
             **/

            for (var Var_j = 0 ; Var_j <= this.var_poid_max_sac; Var_j ++)
            {
                /**
                 * si le poids Var_j est inferieur au poids de l'objet numéro 01
                 */
                if (var_poid_profil[0][0] >Var_j)
                    Var_Matrice[0][Var_j]=0;
                else
                    /**
                     * le poids Var_j est supèrieur au Poid de l'objet numéro 1
                     * on mais le benefice de l'objet dans la case
                     **/
                    Var_Matrice[0][Var_j]=var_poid_profil[0][1];

            }

            /**
             *on rempli le reste de la matrice
             **/
            for (Var_i = 1 ; Var_i < this.var_nb_max_object; Var_i ++)
            {
                for (Var_j = 0 ; Var_j <= this.var_poid_max_sac; Var_j ++){               /**
                 * si le poids Var_j est inferieur au poiids de l'objet numéro i
                 */

                    if (var_poid_profil[Var_i ][0] > Var_j)
                        Var_Matrice[Var_i][Var_j]=Var_Matrice[Var_i-1][Var_j];
                    else/**
                     * le poids Var_j est supèrieur au Poid de l'objet numéro i
                     * on mais le benefice de l'objet dans la case**/
                    {
                        Var_Matrice[Var_i][Var_j]= Math.max ( Var_Matrice[Var_i-1][Var_j],Var_Matrice[Var_i-1][Var_j-var_poid_profil[Var_i][0]]+var_poid_profil[Var_i ][1] );

                    }

                }
            }


            /**
             *recupération du vecteur Solution à partir de la matrice cree en haut
             **/

            /**initialisation des variable i et j pour le parcourt inverse de la matrice**/
            var Var_i =this.var_nb_max_object-1;
            Var_j=this.var_poid_max_sac;
            /**
             *on recupère de la dernière ligne le poid min nécessaire pour le benefice max
             ***/
            while (Var_Matrice[Var_i][Var_j ] == Var_Matrice[Var_i][Var_j-1]) {Var_j--;}
            /**
             *on recupère les objet selectionnée
             ***/

            while(Var_j>0){

                while(Var_i>0 && (Var_Matrice[Var_i][Var_j] == Var_Matrice[Var_i-1 ][Var_j])) Var_i--;
                Var_j =Var_j-var_poid_profil[Var_i][0];
                if(Var_j>=0) this.Var_Liste_Objets_Selectionnee[Var_i]=1;
                Var_i--;
            }
            return this.Var_Liste_Objets_Selectionnee;
        }
    }






</script>
</body>
</html>
